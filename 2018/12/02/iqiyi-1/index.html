<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="吾资之昏，不逮人也，吾材之庸，不逮人也；旦旦而学之，久而不怠焉，迄乎成，而亦不知其昏与庸也。吾资之聪，倍人也，吾材之敏，倍人也；屏弃而不用，其与昏与庸无以异也。圣人之道，卒于鲁也传之。然则昏庸聪敏之用，岂有常哉？"><title>爱奇艺视频爬虫 | 静水流深</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">爱奇艺视频爬虫</h1><a id="logo" href="/.">静水流深</a><p class="description">Just For Fun</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">爱奇艺视频爬虫</h1><div class="post-meta">Dec 2, 2018<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、视频列表页"><span class="toc-number">1.</span> <span class="toc-text">一、视频列表页</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、视频详情页"><span class="toc-number">2.</span> <span class="toc-text">二、视频详情页</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、视频源解析"><span class="toc-number">3.</span> <span class="toc-text">三、视频源解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、如何找到视频呢？"><span class="toc-number">3.1.</span> <span class="toc-text">1、如何找到视频呢？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-首先找到具体的视频链接"><span class="toc-number">3.1.1.</span> <span class="toc-text">a. 首先找到具体的视频链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b-根据真正的视频文件链接查找"><span class="toc-number">3.1.2.</span> <span class="toc-text">b. 根据真正的视频文件链接查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-根据该链接继续往上找"><span class="toc-number">3.1.3.</span> <span class="toc-text">c. 根据该链接继续往上找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#d-继续找，一直找到最上层的请求链接"><span class="toc-number">3.1.4.</span> <span class="toc-text">d. 继续找，一直找到最上层的请求链接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#k-uid"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">k_uid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#authKey"><span class="toc-number">3.1.4.2.</span> <span class="toc-text">authKey</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dfp"><span class="toc-number">3.1.4.3.</span> <span class="toc-text">dfp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#k-ft1"><span class="toc-number">3.1.4.4.</span> <span class="toc-text">k_ft1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bop"><span class="toc-number">3.1.4.5.</span> <span class="toc-text">bop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#callback"><span class="toc-number">3.1.4.6.</span> <span class="toc-text">callback</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vf"><span class="toc-number">3.1.4.7.</span> <span class="toc-text">vf</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="post-content"><p>爱奇艺视频抓取主要分为3步，列表页、详情页、视频源解析</p>
<h1 id="一、视频列表页"><a href="#一、视频列表页" class="headerlink" title="一、视频列表页"></a>一、视频列表页</h1><p><a href="http://www.iqiyi.com/u/1412822955/v" target="_blank" rel="noopener">http://www.iqiyi.com/u/1412822955/v</a></p>
<p>中间参数是用户id，根据用户id抓取该用户下所有的视频。</p>
<p>通过列表页，可以获取到视频的标题、时长等信息，还可以获取到视频的tvid</p>
<p>如下图，视频翻页信息也比较容易获取<br><img src="/images/iqiyi_1.png" alt=""></p>
<h1 id="二、视频详情页"><a href="#二、视频详情页" class="headerlink" title="二、视频详情页"></a>二、视频详情页</h1><p><a href="https://www.iqiyi.com/v_19rrbwtx6w.html" target="_blank" rel="noopener">https://www.iqiyi.com/v_19rrbwtx6w.html</a></p>
<p>可以使用如下接口直接获取数据</p>
<p> <a href="https://pcw-api.iqiyi.com/video/video/baseinfo/936127100?t=1543654272828&amp;callback=window.Q.__callbacks__.cbbj6097" target="_blank" rel="noopener">https://pcw-api.iqiyi.com/video/video/baseinfo/936127100?t=1543654272828&amp;callback=window.Q.__callbacks__.cbbj6097</a></p>
<p>该接口只有<code>936127100</code>是需要替换的，该数字是视频的tvid，t是时间戳，后面的callback可以不用变<br><img src="/images/iqiyi_2.png" alt=""></p>
<h1 id="三、视频源解析"><a href="#三、视频源解析" class="headerlink" title="三、视频源解析"></a>三、视频源解析</h1><p>上面的数据基本上就比较全了，但是没有视频源的链接。最重要的就是这一步，如何找到视频。</p>
<h2 id="1、如何找到视频呢？"><a href="#1、如何找到视频呢？" class="headerlink" title="1、如何找到视频呢？"></a>1、如何找到视频呢？</h2><h3 id="a-首先找到具体的视频链接"><a href="#a-首先找到具体的视频链接" class="headerlink" title="a. 首先找到具体的视频链接"></a>a. 首先找到具体的视频链接</h3><p>翻阅请求链接，找到对应的视频链接，如下：<br><a href="https://v-7cc10085.71edge.com/videos/v0/20180302/54/75/e8cec7fac4b8e38af173e51f600fafae.f4v?key=0593dd9039bdbdadfceb451e73193dac1&amp;dis_k=26ac6922bd9b87f8531b727d5b8e7acad&amp;dis_t=1543656883&amp;dis_dz=GWBN-BeiJing&amp;dis_st=42&amp;src=iqiyi.com&amp;uuid=daf70985-5c0255b3-78&amp;rn=1543656883336&amp;retry=2&amp;qd_tm=1543656836177&amp;qd_vipdyn=0&amp;qd_k=ce09023bf1030d00183b871874d25df7&amp;cross-domain=1&amp;pv=0.1&amp;qyid=a1b97b80f70476f67d4c380242c4beed&amp;qd_aid=215235201&amp;qd_stert=0&amp;qypid=948145700_01080031010000000000&amp;qd_p=daf70985&amp;qd_vip=0&amp;z=wangsucdn_cnc|baiducdn_cnc&amp;qd_index=1&amp;qd_src=01010031010000000000&amp;qd_tvid=948145700&amp;pri_idc=beijing3_cnc&amp;qd_vipres=0&amp;qd_uid=&amp;range=8192-15074468" target="_blank" rel="noopener">https://v-7cc10085.71edge.com/videos/v0/20180302/54/75/e8cec7fac4b8e38af173e51f600fafae.f4v?key=0593dd9039bdbdadfceb451e73193dac1&amp;dis_k=26ac6922bd9b87f8531b727d5b8e7acad&amp;dis_t=1543656883&amp;dis_dz=GWBN-BeiJing&amp;dis_st=42&amp;src=iqiyi.com&amp;uuid=daf70985-5c0255b3-78&amp;rn=1543656883336&amp;retry=2&amp;qd_tm=1543656836177&amp;qd_vipdyn=0&amp;qd_k=ce09023bf1030d00183b871874d25df7&amp;cross-domain=1&amp;pv=0.1&amp;qyid=a1b97b80f70476f67d4c380242c4beed&amp;qd_aid=215235201&amp;qd_stert=0&amp;qypid=948145700_01080031010000000000&amp;qd_p=daf70985&amp;qd_vip=0&amp;z=wangsucdn_cnc|baiducdn_cnc&amp;qd_index=1&amp;qd_src=01010031010000000000&amp;qd_tvid=948145700&amp;pri_idc=beijing3_cnc&amp;qd_vipres=0&amp;qd_uid=&amp;range=8192-15074468</a></p>
<p>可以下载下来看一下，看看是否是真正的视频（有可能是广告）。<br><img src="/images/iqiyi_4.png" alt=""></p>
<h3 id="b-根据真正的视频文件链接查找"><a href="#b-根据真正的视频文件链接查找" class="headerlink" title="b. 根据真正的视频文件链接查找"></a>b. 根据真正的视频文件链接查找</h3><p>可以根据 <a href="https://v-7cc10085.71edge.com/videos/v0/20180302/54/75/e8cec7fac4b8e38af173e51f600fafae.f4v" target="_blank" rel="noopener">https://v-7cc10085.71edge.com/videos/v0/20180302/54/75/e8cec7fac4b8e38af173e51f600fafae.f4v</a> 查找，如下图，发现有两个该地址，其中有一个的返回参数中是该地址<br><img src="/images/iqiyi_5.png" alt=""></p>
<p>看一下返回值：<br><img src="/images/iqiyi_6.png" alt=""></p>
<p>该请求的链接为</p>
<p><a href="https://data.video.iqiyi.com/videos/v0/20180302/54/75/e8cec7fac4b8e38af173e51f600fafae.f4v?qd_tvid=948145700&amp;qd_vipres=0&amp;qd_index=1&amp;qd_aid=215235201&amp;qd_stert=0&amp;qd_scc=201b52fce94e6a1e1c3fbe0584eb0bc8&amp;qd_sc=b44bc809923064b03e096a07def1514e&amp;qd_p=daf70985&amp;qd_k=ce09023bf1030d00183b871874d25df7&amp;qd_src=01010031010000000000&amp;qd_vipdyn=0&amp;qd_uid=&amp;qd_tm=1543656836177&amp;qd_vip=0&amp;cross-domain=1&amp;qyid=a1b97b80f70476f67d4c380242c4beed&amp;qypid=948145700_01080031010000000000&amp;qypid=948145700_01080031010000000000&amp;rn=1543656883336&amp;pv=0.1&amp;cross-domain=1&amp;retry=2&amp;z=wangsucdn_cnc|baiducdn_cnc&amp;pri_idc=beijing3_cnc" target="_blank" rel="noopener">https://data.video.iqiyi.com/videos/v0/20180302/54/75/e8cec7fac4b8e38af173e51f600fafae.f4v?qd_tvid=948145700&amp;qd_vipres=0&amp;qd_index=1&amp;qd_aid=215235201&amp;qd_stert=0&amp;qd_scc=201b52fce94e6a1e1c3fbe0584eb0bc8&amp;qd_sc=b44bc809923064b03e096a07def1514e&amp;qd_p=daf70985&amp;qd_k=ce09023bf1030d00183b871874d25df7&amp;qd_src=01010031010000000000&amp;qd_vipdyn=0&amp;qd_uid=&amp;qd_tm=1543656836177&amp;qd_vip=0&amp;cross-domain=1&amp;qyid=a1b97b80f70476f67d4c380242c4beed&amp;qypid=948145700_01080031010000000000&amp;qypid=948145700_01080031010000000000&amp;rn=1543656883336&amp;pv=0.1&amp;cross-domain=1&amp;retry=2&amp;z=wangsucdn_cnc|baiducdn_cnc&amp;pri_idc=beijing3_cnc</a></p>
<h3 id="c-根据该链接继续往上找"><a href="#c-根据该链接继续往上找" class="headerlink" title="c. 根据该链接继续往上找"></a>c. 根据该链接继续往上找</h3><p>根据该请求的参数继续搜索，会找到这样一个链接。<br><img src="/images/iqiyi_7.png" alt=""></p>
<p>看一下该链接返回的部分请求<br><img src="/images/iqiyi_8.png" alt=""></p>
<p>从图上可以看出，该链接可以由2个参数拼接而成。</p>
<p>链接地址：</p>
<p><a href="https://cache.video.iqiyi.com/jp/dash?tvid=948145700&amp;bid=300&amp;vid=09e057ad7b03f2616a007cd90d3c429d&amp;src=01010031010000000000&amp;vt=0&amp;rs=1&amp;uid=&amp;ori=pcw&amp;ps=0&amp;tm=1543656836919&amp;qd_v=1&amp;k_uid=a1b97b80f70476f67d4c380242c4beed&amp;pt=0&amp;d=0&amp;s=&amp;lid=&amp;cf=&amp;ct=&amp;authKey=1756f66fda45b581f60e8c5345b1f49b&amp;k_tag=1&amp;ost=0&amp;ppt=0&amp;dfp=a0c6296852fce442fb9ee3af8f6411d2fb8ac1b538dcf2d3a25a54b26648919f07&amp;locale=zh_cn&amp;prio=%7B%22ff%22%3A%22f4v%22%2C%22code%22%3A2%7D&amp;pck=&amp;k_err_retries=0&amp;k_ft1=2748779069444&amp;bop=%7B%22version%22%3A%227.0%22%2C%22dfp%22%3A%22a0c6296852fce442fb9ee3af8f6411d2fb8ac1b538dcf2d3a25a54b26648919f07%22%7D&amp;callback=Q838114a04d5d4d3adb265513f3244a36&amp;ut=0&amp;vf=ce09023bf1030d00183b871874d25df7" target="_blank" rel="noopener">https://cache.video.iqiyi.com/jp/dash?tvid=948145700&amp;bid=300&amp;vid=09e057ad7b03f2616a007cd90d3c429d&amp;src=01010031010000000000&amp;vt=0&amp;rs=1&amp;uid=&amp;ori=pcw&amp;ps=0&amp;tm=1543656836919&amp;qd_v=1&amp;k_uid=a1b97b80f70476f67d4c380242c4beed&amp;pt=0&amp;d=0&amp;s=&amp;lid=&amp;cf=&amp;ct=&amp;authKey=1756f66fda45b581f60e8c5345b1f49b&amp;k_tag=1&amp;ost=0&amp;ppt=0&amp;dfp=a0c6296852fce442fb9ee3af8f6411d2fb8ac1b538dcf2d3a25a54b26648919f07&amp;locale=zh_cn&amp;prio=%7B%22ff%22%3A%22f4v%22%2C%22code%22%3A2%7D&amp;pck=&amp;k_err_retries=0&amp;k_ft1=2748779069444&amp;bop=%7B%22version%22%3A%227.0%22%2C%22dfp%22%3A%22a0c6296852fce442fb9ee3af8f6411d2fb8ac1b538dcf2d3a25a54b26648919f07%22%7D&amp;callback=Q838114a04d5d4d3adb265513f3244a36&amp;ut=0&amp;vf=ce09023bf1030d00183b871874d25df7</a></p>
<h3 id="d-继续找，一直找到最上层的请求链接"><a href="#d-继续找，一直找到最上层的请求链接" class="headerlink" title="d. 继续找，一直找到最上层的请求链接"></a>d. 继续找，一直找到最上层的请求链接</h3><p>发现找到不对应的链接信息了，也就是需要拼接的链接就是这个，这个也是js中拼接的请求链接。<br>接下来就需要拼接该链接。</p>
<p>urldecoder解码之后看一下链接：<br><a href="https://cache.video.iqiyi.com/jp/dash?tvid=948145700&amp;bid=300&amp;vid=09e057ad7b03f2616a007cd90d3c429d&amp;src=01010031010000000000&amp;vt=0&amp;rs=1&amp;uid=&amp;ori=pcw&amp;ps=0&amp;tm=1543656836919&amp;qd_v=1&amp;k_uid=a1b97b80f70476f67d4c380242c4beed&amp;pt=0&amp;d=0&amp;s=&amp;lid=&amp;cf=&amp;ct=&amp;authKey=1756f66fda45b581f60e8c5345b1f49b&amp;k_tag=1&amp;ost=0&amp;ppt=0&amp;dfp=a0c6296852fce442fb9ee3af8f6411d2fb8ac1b538dcf2d3a25a54b26648919f07&amp;locale=zh_cn&amp;prio={&quot;ff&quot;:&quot;f4v&quot;,&quot;code&quot;:2}&amp;pck=&amp;k_err_retries=0&amp;k_ft1=2748779069444&amp;bop={&quot;version&quot;:&quot;7.0&quot;,&quot;dfp&quot;:&quot;a0c6296852fce442fb9ee3af8f6411d2fb8ac1b538dcf2d3a25a54b26648919f07&quot;}&amp;callback=Q838114a04d5d4d3adb265513f3244a36&amp;ut=0&amp;vf=ce09023bf1030d00183b871874d25df7" target="_blank" rel="noopener">https://cache.video.iqiyi.com/jp/dash?tvid=948145700&amp;bid=300&amp;vid=09e057ad7b03f2616a007cd90d3c429d&amp;src=01010031010000000000&amp;vt=0&amp;rs=1&amp;uid=&amp;ori=pcw&amp;ps=0&amp;tm=1543656836919&amp;qd_v=1&amp;k_uid=a1b97b80f70476f67d4c380242c4beed&amp;pt=0&amp;d=0&amp;s=&amp;lid=&amp;cf=&amp;ct=&amp;authKey=1756f66fda45b581f60e8c5345b1f49b&amp;k_tag=1&amp;ost=0&amp;ppt=0&amp;dfp=a0c6296852fce442fb9ee3af8f6411d2fb8ac1b538dcf2d3a25a54b26648919f07&amp;locale=zh_cn&amp;prio={&quot;ff&quot;:&quot;f4v&quot;,&quot;code&quot;:2}&amp;pck=&amp;k_err_retries=0&amp;k_ft1=2748779069444&amp;bop={&quot;version&quot;:&quot;7.0&quot;,&quot;dfp&quot;:&quot;a0c6296852fce442fb9ee3af8f6411d2fb8ac1b538dcf2d3a25a54b26648919f07&quot;}&amp;callback=Q838114a04d5d4d3adb265513f3244a36&amp;ut=0&amp;vf=ce09023bf1030d00183b871874d25df7</a></p>
<p>将链接中的参数做拆解<br><img src="/images/iqiyi_16.png" alt=""></p>
<p>挨个分析一下变化的参数；</p>
<p>首先tvid、vid可以从数据中获取到，tm是一个时间戳，其他的几个都不知道是啥。</p>
<p>那需要分析的参数就是k_uid、authKey、dfp、k_ft1、bop、callback、vf</p>
<h4 id="k-uid"><a href="#k-uid" class="headerlink" title="k_uid"></a>k_uid</h4><p>在搜索k_uid参数的时候，发现，其他几个参数也基本都在这，所以我们索性截一个大图慢慢看，如下：</p>
<p><img src="/images/iqiyi_17.png" alt=""></p>
<p>k_uid获取的是 l.getFluid() || l.getJsuid()</p>
<p>然后继续打断点找getFluid和getJsuid<br><img src="/images/iqiyi_3.png" alt=""></p>
<p>找到了对应的getFluid和getJsuid，不过这个参数其实不用这么复杂，其实它就是一个随机的32位字符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getk_uid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   Random random = <span class="keyword">new</span> Random();</span><br><span class="line">   <span class="keyword">char</span>[] chars = <span class="keyword">new</span> <span class="keyword">char</span>[] &#123; <span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span> &#125;;</span><br><span class="line">   String id = <span class="string">""</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; <span class="number">32</span>; index++) &#123;</span><br><span class="line">     id += chars[random.nextInt(<span class="number">15</span>) + <span class="number">1</span>];</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> id;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="authKey"><a href="#authKey" class="headerlink" title="authKey"></a>authKey</h4><p>从下图可以看到 <code>r(r(&quot;&quot;) + L + x)</code>，打断点跟踪。通过下图可以发现，L和x都是已知的，一个是tvid，一个是时间戳<br><img src="/images/iqiyi_10.png" alt=""></p>
<p>通过这个找到r方法。<br><img src="/images/iqiyi_11.png" alt=""></p>
<p>这个是r方法<br><img src="/images/iqiyi_13.png" alt=""></p>
<p>看这个发现，要让r方法执行，需要有p、n、u几个变量</p>
<p>从最里面找，先找u，u里面全是已知项<br><img src="/images/iqiyi_15.png" alt=""></p>
<p>继续往外找，按照刚才的方法继续找n，依次找下去。一直找到最后，没有任何依赖项的时候，把所有找到的方法拼起来，就可以了。<br><img src="/images/iqiyi_12.png" alt=""></p>
<p>最后将这些js抽取出来，组成自己的解析就可以直接使用了。<br><img src="/images/iqiyi_14.png" alt=""></p>
<h4 id="dfp"><a href="#dfp" class="headerlink" title="dfp"></a>dfp</h4><p>跟踪之前在上面的图中可以看到<code>dfp: g.get()</code>。<br>该参数可以为空，也可以随意设置，不影响数据的获取，可以先看别的</p>
<h4 id="k-ft1"><a href="#k-ft1" class="headerlink" title="k_ft1"></a>k_ft1</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (a.os.ios || a.os.android) &amp;&amp; (e.ori = <span class="string">"h5"</span>), c.src &amp;&amp; (e.src = c.src), c.preIdAll &amp;&amp; (e.preIdAll = c.preIdAll), <span class="number">-1</span> != e.prio.indexOf(<span class="string">"m3u8"</span>) ? e.k_ft1 = y.getM3U8FT1() : <span class="number">-1</span> != e.prio.indexOf(<span class="string">"mp4"</span>) ? e.k_ft1 = y.getMP4FT1() : e.k_ft1 = y.getFT1(), u.isTraditionalChinese() &amp;&amp; (e.locale = <span class="string">"zh_tw"</span>), v.isBoss() &amp;&amp; (e.vv = <span class="string">"821d3c731e374feaa629dcdaab7c394b"</span>), q &amp;&amp; (e.ecode = <span class="string">"701"</span>), e.bop = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    version: <span class="string">"7.0"</span>,</span><br><span class="line">    dfp: g.get()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>用同样的方法打断点跟踪，如下图<br><img src="/images/iqiyi_18.png" alt=""><br>用同样分析 authKey 时做的方法，去拆解该参数相关的方法，一直找到没有任何未知参数为止，然后把这些js方法拼接起来直接使用。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getk_ft1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">s</span>(<span class="params">e, t</span>) </span>&#123;</span><br><span class="line">		c[e][t] = !<span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params">e, t</span>) </span>&#123;</span><br><span class="line">		c[e][t] = !<span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">l</span>(<span class="params">e, t</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> c[e][t]</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> c = &#123;</span><br><span class="line">		<span class="number">1</span> : &#123;</span><br><span class="line">			<span class="number">3</span> : !<span class="number">0</span>,</span><br><span class="line">			<span class="number">37</span> : !<span class="number">1</span>,</span><br><span class="line">			<span class="number">40</span> : !<span class="number">0</span>,</span><br><span class="line">			<span class="number">42</span> : !<span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="number">2</span> : &#123;&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> e = [], t = <span class="number">1</span>; t &lt;= <span class="number">64</span>; t++)</span><br><span class="line">		e.push(c[<span class="number">1</span>][t] ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">parseInt</span>(e.reverse().join(<span class="string">""</span>), <span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="bop"><a href="#bop" class="headerlink" title="bop"></a>bop</h4><p>该参数跟dfp参数有关，这个就比较简单了。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getbop</span>(<span class="params">dfp, version</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">encodeURI</span>(<span class="string">"&#123;\"version\":\""</span> + version + <span class="string">"\",\"dfp\":\""</span> + dfp</span><br><span class="line">			+ <span class="string">"\"&#125;"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>version设置为7.0就可以，dfp空着就ok</p>
<h4 id="callback"><a href="#callback" class="headerlink" title="callback"></a>callback</h4><p>同样的方法做跟踪<br><img src="/images/iqiyi_19.png" alt=""><br>继续跟下去，发现该参数调用了 authKey 方法，而传入的参数是一个地址。如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> url = <span class="string">"http://cache.video.iqiyi.com/jp/dash"</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">"Q"</span> + authkey(url)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="vf"><a href="#vf" class="headerlink" title="vf"></a>vf</h4><p>继续往下看最后一个参数<br><img src="/images/iqiyi_20.png" alt=""><br>发现<code>p.cmd5x(a)</code> 这个就是vf参数。<br>而a就是上面拼接好的url，只是缺少了域名和最后一个参数，链接如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/jp/dash?tvid=948145700&amp;bid=300&amp;vid=09e057ad7b03f2616a007cd90d3c429d&amp;src=01010031010000000000&amp;vt=0&amp;rs=1&amp;uid=&amp;ori=pcw&amp;ps=0&amp;tm=1543656836919&amp;qd_v=1&amp;k_uid=a1b97b80f70476f67d4c380242c4beed&amp;pt=0&amp;d=0&amp;s=&amp;lid=&amp;cf=&amp;ct=&amp;authKey=1756f66fda45b581f60e8c5345b1f49b&amp;k_tag=1&amp;ost=0&amp;ppt=0&amp;dfp=a0c6296852fce442fb9ee3af8f6411d2fb8ac1b538dcf2d3a25a54b26648919f07&amp;locale=zh_cn&amp;prio=%7B%22ff%22%3A%22f4v%22%2C%22code%22%3A2%7D&amp;pck=&amp;k_err_retries=0&amp;k_ft1=2748779069444&amp;bop=%7B%22version%22%3A%227.0%22%2C%22dfp%22%3A%22a0c6296852fce442fb9ee3af8f6411d2fb8ac1b538dcf2d3a25a54b26648919f07%22%7D&amp;callback=Q838114a04d5d4d3adb265513f3244a36&amp;ut=0</span><br></pre></td></tr></table></figure></p>
<p>cmd5x方法这个js太长了，就不贴在博客里面了。<br>把鼠标放在该方法上，可以看到cmd5x方法，直接使用就可以<br><img src="/images/iqiyi_21.png" alt=""></p>
<p>至此为止，所有参数都找到了，可以直接开始抓取了</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.thinkyixia.com/2018/12/02/iqiyi-1/" data-id="cjp9apsro001ez1rxubexgchv" class="article-share-link">分享</a><div class="tags"><a href="/tags/爬虫/">爬虫</a><a href="/tags/视频/">视频</a><a href="/tags/爱奇艺/">爱奇艺</a></div><div class="post-nav"><a href="/2018/12/04/baoxian-8/" class="pre">保险业学习文章汇总兼资料整理</a><a href="/2018/12/01/youku-1/" class="next">优酷视频爬虫</a></div><div id="uyan_frame"></div><script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2140943"></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/保险/">保险</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">32</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/经济/">经济</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书看报/">读书看报</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/保险/" style="font-size: 15px;">保险</a> <a href="/tags/flume/" style="font-size: 15px;">flume</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/复利/" style="font-size: 15px;">复利</a> <a href="/tags/杂谈/" style="font-size: 15px;">杂谈</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Xcode/" style="font-size: 15px;">Xcode</a> <a href="/tags/hdfs/" style="font-size: 15px;">hdfs</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/视频/" style="font-size: 15px;">视频</a> <a href="/tags/爱奇艺/" style="font-size: 15px;">爱奇艺</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/经济/" style="font-size: 15px;">经济</a> <a href="/tags/今日头条/" style="font-size: 15px;">今日头条</a> <a href="/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/tags/elk/" style="font-size: 15px;">elk</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/广告/" style="font-size: 15px;">广告</a> <a href="/tags/资源/" style="font-size: 15px;">资源</a> <a href="/tags/图片/" style="font-size: 15px;">图片</a> <a href="/tags/git动图/" style="font-size: 15px;">git动图</a> <a href="/tags/工具/" style="font-size: 15px;">工具</a> <a href="/tags/微信公众号/" style="font-size: 15px;">微信公众号</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/scala/" style="font-size: 15px;">scala</a> <a href="/tags/三国/" style="font-size: 15px;">三国</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/spark-streaming/" style="font-size: 15px;">spark streaming</a> <a href="/tags/yarn/" style="font-size: 15px;">yarn</a> <a href="/tags/优酷/" style="font-size: 15px;">优酷</a> <a href="/tags/从0到1/" style="font-size: 15px;">从0到1</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/04/baoxian-7/">香港精算学会前会长，陆健瑜先生教你如何衡量一家寿险公司</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/04/baoxian-8/">保险业学习文章汇总兼资料整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/02/iqiyi-1/">爱奇艺视频爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/01/youku-1/">优酷视频爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/26/jingji-1/">凯恩斯与弗里德曼</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/26/jingji-2/">“通货膨胀”不过是资产阶级经济学家们编造出来骗人的把戏</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/22/sanguo-1/">由“煮酒论英雄”看三国智慧</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/20/jiritoutiao-1/">今日头条视频爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/17/navigation_gif/">gif图片资源</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/17/navigation_tools/">互联网使用小工具</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://dmlcoding.com/" title="Time渐行渐远" target="_blank">Time渐行渐远</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">静水流深.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?6bb438845012aea06ac1088574d28aa6";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>