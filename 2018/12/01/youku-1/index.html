<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="吾资之昏，不逮人也，吾材之庸，不逮人也；旦旦而学之，久而不怠焉，迄乎成，而亦不知其昏与庸也。吾资之聪，倍人也，吾材之敏，倍人也；屏弃而不用，其与昏与庸无以异也。圣人之道，卒于鲁也传之。然则昏庸聪敏之用，岂有常哉？"><title>优酷视频爬虫 | 静水流深</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">优酷视频爬虫</h1><a id="logo" href="/.">静水流深</a><p class="description">Just For Fun</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">优酷视频爬虫</h1><div class="post-meta">Dec 1, 2018<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#首先是列表页"><span class="toc-number">1.</span> <span class="toc-text">首先是列表页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#列表翻页"><span class="toc-number">1.1.</span> <span class="toc-text">列表翻页</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视频详情页链接"><span class="toc-number">2.</span> <span class="toc-text">视频详情页链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拼接视频解析链接"><span class="toc-number">3.</span> <span class="toc-text">拼接视频解析链接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vid"><span class="toc-number">3.1.</span> <span class="toc-text">vid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#client-ts"><span class="toc-number">3.2.</span> <span class="toc-text">client_ts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#utid"><span class="toc-number">3.3.</span> <span class="toc-text">utid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ckey"><span class="toc-number">3.4.</span> <span class="toc-text">ckey</span></a></li></ol></li></ol></div></div><div class="post-content"><p>优酷视频抓取主要分为3步，列表页、详情页、视频源解析</p>
<p>该视频抓取主要是根据用户id获取该用户下所有的视频。跟获取全部视频没有任何差别。</p>
<h2 id="首先是列表页"><a href="#首先是列表页" class="headerlink" title="首先是列表页"></a>首先是列表页</h2><p><a href="http://i.youku.com/i/UMTI5OTA2MzIwOA==/videos" target="_blank" rel="noopener">http://i.youku.com/i/UMTI5OTA2MzIwOA==/videos</a></p>
<p>中间的参数就是用户id，根据用户的id获取视频列表。</p>
<p>列表上边的视频信息很容易获取到，包括视频的名称、详情、播放次数、上传时间等，最重要的是可以获取到视频详情页的地址，如下：<br><img src="/images/youku_1.png" alt=""></p>
<h3 id="列表翻页"><a href="#列表翻页" class="headerlink" title="列表翻页"></a>列表翻页</h3><p>列表翻页比较容易找，页面中没有做任何隐藏，如下<br><img src="/images/youku_5.png" alt=""></p>
<h2 id="视频详情页链接"><a href="#视频详情页链接" class="headerlink" title="视频详情页链接"></a>视频详情页链接</h2><p>从列表页可以很容易获取到视频详情页链接<br><img src="/images/youku_2.png" alt=""></p>
<p>详情页可以看到视频的地址，如下：<br><a href="http://pl-ali.youku.com/playlist/m3u8?vid=XMzkxNzY2MDIxMg&amp;type=flvhdv3&amp;ups_client_netip=daf70985&amp;utid=SjxXFGz%2FUnECAWX%2B8woFwZ8Z&amp;ccode=0502&amp;psid=63b8b4da2b8eb3ecc93879e59c186598&amp;ups_userid=1075200454&amp;ups_ytid=1075200454&amp;duration=1019&amp;expire=18000&amp;drm_type=1&amp;drm_device=7&amp;ups_ts=1543646420&amp;onOff=0&amp;encr=0&amp;ups_key=0f6e70dd048b3606eef5beec65644549" target="_blank" rel="noopener">http://pl-ali.youku.com/playlist/m3u8?vid=XMzkxNzY2MDIxMg&amp;type=flvhdv3&amp;ups_client_netip=daf70985&amp;utid=SjxXFGz%2FUnECAWX%2B8woFwZ8Z&amp;ccode=0502&amp;psid=63b8b4da2b8eb3ecc93879e59c186598&amp;ups_userid=1075200454&amp;ups_ytid=1075200454&amp;duration=1019&amp;expire=18000&amp;drm_type=1&amp;drm_device=7&amp;ups_ts=1543646420&amp;onOff=0&amp;encr=0&amp;ups_key=0f6e70dd048b3606eef5beec65644549</a></p>
<p>但是看到，却拿不到该地址，需要通过请求接口才可以拿到。</p>
<h2 id="拼接视频解析链接"><a href="#拼接视频解析链接" class="headerlink" title="拼接视频解析链接"></a>拼接视频解析链接</h2><p>使用如下请求接口，获取视频源地址：</p>
<p><a href="https://ups.youku.com/ups/get.json?vid=XMzkxNzY2MDIxMg==&amp;ccode=0502&amp;client_ip=192.168.1.1&amp;utid=CSqJFEfc5CgCAdr3CYXvTZbD&amp;client_ts=1543650312&amp;ckey=DIl58SLFxFNndSV1GFNnMQVYkx1PP5tKe1siZu%2F86PR1u%2FWh1Ptd%2BWOZsHHWxysSfAOhNJpdVWsdVJNsfJ8Sxd8WKVvNfAS8aS8fAOzYARzPyPc3JvtnPHjTdKfESTdnuTW6ZPvk2pNDh4uFzotgdMEFkzQ5wZVXl2Pf1%2FY6hLK0OnCNxBj3%2Bnb0v72gZ6b0td%2BWOZsHHWxysSo%2F0y9D2K42SaB8Y%2F%2BaD2K42SaB8Y%2F%2BahU%2BWOZsHcrxysooUeND" target="_blank" rel="noopener">https://ups.youku.com/ups/get.json?vid=XMzkxNzY2MDIxMg==&amp;ccode=0502&amp;client_ip=192.168.1.1&amp;utid=CSqJFEfc5CgCAdr3CYXvTZbD&amp;client_ts=1543650312&amp;ckey=DIl58SLFxFNndSV1GFNnMQVYkx1PP5tKe1siZu%2F86PR1u%2FWh1Ptd%2BWOZsHHWxysSfAOhNJpdVWsdVJNsfJ8Sxd8WKVvNfAS8aS8fAOzYARzPyPc3JvtnPHjTdKfESTdnuTW6ZPvk2pNDh4uFzotgdMEFkzQ5wZVXl2Pf1%2FY6hLK0OnCNxBj3%2Bnb0v72gZ6b0td%2BWOZsHHWxysSo%2F0y9D2K42SaB8Y%2F%2BaD2K42SaB8Y%2F%2BahU%2BWOZsHcrxysooUeND</a></p>
<p>具体参数情况</p>
<p><img src="/images/youku_7.png" alt=""></p>
<p>由上图可以看出，可变的参数只有vid、client_ts、utid、ckey三个。</p>
<h3 id="vid"><a href="#vid" class="headerlink" title="vid"></a>vid</h3><p>vid是视频的id，从列表页和视频详情页均可获取。</p>
<h3 id="client-ts"><a href="#client-ts" class="headerlink" title="client_ts"></a>client_ts</h3><p>该参数是时间戳，当前时间戳即可</p>
<h3 id="utid"><a href="#utid" class="headerlink" title="utid"></a>utid</h3><p>该参数可以通过请求 <a href="https://log.mmstat.com/eg.js" target="_blank" rel="noopener">https://log.mmstat.com/eg.js</a> 链接获取</p>
<p>请求结果：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.goldlog=(<span class="built_in">window</span>.goldlog||&#123;&#125;);goldlog.Etag=<span class="string">"Hre6ErRmgVQCAXb364XhncX+"</span>;goldlog.stag=<span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="ckey"><a href="#ckey" class="headerlink" title="ckey"></a>ckey</h3><p>通过打断点跟踪可以发现，该参数就是浏览器的ua信息，如果获取不到就默认给一个，所以可以写死，或者提供其他的ua信息。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getCkey: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.uabModule ? <span class="keyword">this</span>.uabModule.getUA() : <span class="string">"DIl58SLFxFNndSV1GFNnMQVYkx1PP5tKe1siZu/86PR1u/Wh1Ptd+WOZsHHWxysSfAOhNJpdVWsdVJNsfJ8Sxd8WKVvNfAS8aS8fAOzYARzPyPc3JvtnPHjTdKfESTdnuTW6ZPvk2pNDh4uFzotgdMEFkzQ5wZVXl2Pf1/Y6hLK0OnCNxBj3+nb0v72gZ6b0td+WOZsHHWxysSo/0y9D2K42SaB8Y/+aD2K42SaB8Y/+ahU+WOZsHcrxysooUeND"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/youku_4.png" alt=""></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.thinkyixia.com/2018/12/01/youku-1/" data-id="cjp99dwko003jt7rxddccxls2" class="article-share-link">分享</a><div class="tags"><a href="/tags/爬虫/">爬虫</a><a href="/tags/视频/">视频</a><a href="/tags/优酷/">优酷</a></div><div class="post-nav"><a href="/2018/12/02/iqiyi-1/" class="pre">爱奇艺视频爬虫</a><a href="/2018/11/26/jingji-2/" class="next">“通货膨胀”不过是资产阶级经济学家们编造出来骗人的把戏</a></div><div id="uyan_frame"></div><script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2140943"></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/保险/">保险</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">32</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/经济/">经济</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书看报/">读书看报</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/保险/" style="font-size: 15px;">保险</a> <a href="/tags/flume/" style="font-size: 15px;">flume</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/复利/" style="font-size: 15px;">复利</a> <a href="/tags/杂谈/" style="font-size: 15px;">杂谈</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Xcode/" style="font-size: 15px;">Xcode</a> <a href="/tags/hdfs/" style="font-size: 15px;">hdfs</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/经济/" style="font-size: 15px;">经济</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/视频/" style="font-size: 15px;">视频</a> <a href="/tags/爱奇艺/" style="font-size: 15px;">爱奇艺</a> <a href="/tags/今日头条/" style="font-size: 15px;">今日头条</a> <a href="/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/tags/elk/" style="font-size: 15px;">elk</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/资源/" style="font-size: 15px;">资源</a> <a href="/tags/工具/" style="font-size: 15px;">工具</a> <a href="/tags/图片/" style="font-size: 15px;">图片</a> <a href="/tags/广告/" style="font-size: 15px;">广告</a> <a href="/tags/git动图/" style="font-size: 15px;">git动图</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/scala/" style="font-size: 15px;">scala</a> <a href="/tags/微信公众号/" style="font-size: 15px;">微信公众号</a> <a href="/tags/三国/" style="font-size: 15px;">三国</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/spark-streaming/" style="font-size: 15px;">spark streaming</a> <a href="/tags/优酷/" style="font-size: 15px;">优酷</a> <a href="/tags/从0到1/" style="font-size: 15px;">从0到1</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/yarn/" style="font-size: 15px;">yarn</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/04/baoxian-7/">香港精算学会前会长，陆健瑜先生教你如何衡量一家寿险公司</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/02/iqiyi-1/">爱奇艺视频爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/01/youku-1/">优酷视频爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/26/jingji-2/">“通货膨胀”不过是资产阶级经济学家们编造出来骗人的把戏</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/26/jingji-1/">凯恩斯与弗里德曼</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/22/sanguo-1/">由“煮酒论英雄”看三国智慧</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/20/jiritoutiao-1/">今日头条视频爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/17/navigation_wx_tools/">优质公众号必备工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/17/navigation_gif/">gif图片资源</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/17/navigation_img/">有了这些资源，还需要ui吗？</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://dmlcoding.com/" title="Time渐行渐远" target="_blank">Time渐行渐远</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">静水流深.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?6bb438845012aea06ac1088574d28aa6";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>